# 栄養データベース構造分析

## 既存のデータベース（database.ts）構造

```typescript
// 仮の食品データベース
const FOOD_DATABASE: Record<string, DatabaseFoodItem> = {
    "ご飯": {
        name: "ご飯",
        calories: 168,
        protein: 2.5,
        iron: 0.1,
        folic_acid: 3,
        calcium: 3,
        standard_quantity: "100g",
        aliases: ["白米", "ライス"]
    },
    // 他の食品データ...
};
```

## 新しいデータベース（food_nutrition_database.json）構造

```json
{
  "foods": {
    "えんばく　オートミール": {
      "name": "えんばく　オートミール",
      "id": "01004",
      "calories": 350.0,
      "protein": 13.7,
      "iron": 3.9,
      "folic_acid": 30.0,
      "calcium": 47.0,
      "vitamin_d": 0.0,
      "standard_quantity": "100g",
      "aliases": [
        "オート",
        "オーツ"
      ]
    },
    // 他の食品データ...
  }
}
```

## 差異分析

### 構造的な差異

1. **データ包含構造**:
   - 既存: フラットなオブジェクト構造で `FOOD_DATABASE` に直接食品マッピング
   - 新規: `foods` オブジェクト内に食品データを包含

2. **属性の差異**:
   - 新規データには以下の追加属性があります:
     - `id`: 食品識別子（例: "01004"）
     - `vitamin_d`: ビタミンD含有量

### 属性の型と精度

1. **数値の精度**:
   - 既存: 小数点以下1桁程度（例: 168, 2.5）
   - 新規: 小数点以下1桁〜2桁（例: 350.0, 13.7）

2. **単位**:
   - 既存と新規で同じ単位系を使用している（例: standard_quantity = "100g"）

### 対応必要な変更点

1. **データ構造統一**:
   - `NutritionDatabase` クラスで新構造を読み込む際に、内部構造を一貫させる必要あり
   - `foods` オブジェクト内のデータを取り出して使用する処理が必要

2. **型定義の更新**:
   - `DatabaseFoodItem` インターフェースに `id` と `vitamin_d` フィールドを追加する
   - （既存の型定義では `vitamin_d` はすでに含まれているが、実装で使われていない）

3. **データマージのロジック**:
   - 重複する食品のマージ戦略を決定する必要あり
   - キャッシング戦略も検討する必要あり

## 次のステップ（提案）

1. **型定義の更新**: `DatabaseFoodItem` インターフェースを必要に応じて更新
2. **ローダー機能の実装**: 新しいJSON形式を適切に読み込むコードの実装
3. **移行戦略**: 既存データと新データの共存または置き換え方針の決定
4. **テスト**: 更新されたデータベース機能のユニットテストの実施 