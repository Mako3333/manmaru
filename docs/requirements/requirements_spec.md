妊婦向け栄養管理アプリMVP 要件定義書（完成版）
はじめに
LLM活用の根拠（sauce）と免責事項の提示
	1. 当アプリでは、食事記録や栄養素推定、献立レコメンドに一部LLM（大規模言語モデル）による回答や推定ロジックを採用しており、 
		○ LLMからの回答や計算結果は常に正確とは限りません。
		○ 医療的判断や処方に代わるものではなく、参考情報としてご利用ください。
	2. 妊娠中の健康管理や医療上の重要な事項については、必ずかかりつけの医師や専門家にご相談ください。
	3. 本アプリは、妊婦の「簡易的な栄養管理と献立作成支援」を目的としており、医療行為や健康診断の代替にはなりません。
ユーザー同意ボタンの追加
	• アプリ起動・初回登録時に、上記免責事項を表示したうえで「同意する」ボタンを設置。
	• ユーザーが同意しない場合は、アプリの主要機能（食事記録や献立提案）を利用できない仕様とする（利用規約の一部として扱う）。

1. 対象ユーザー／ペルソナ
	• 主なユーザー: 妊娠中の女性（子育てと仕事を両立する多忙な層）
	• ニーズ: 
		○ 栄養管理（カロリー、タンパク質、鉄分、葉酸などの適正摂取）
		○ 時間短縮（1回の入力が1〜2分で完了するUI）
		○ 夕食献立のアイデア提供
		○ 将来的な家族全体の食事管理への拡張可能性

2. 主要機能（MVP）
2-1. ユーザープロファイル設定
	• 機能ID: F-001
	• 機能名: ユーザープロファイル登録・編集
	• 説明:
ユーザーの基本情報（年齢、性別、妊娠週数または出産予定日、身長、体重、目標体重または体重増加目安）を登録・編集し、
そこからLLMの計算ロジックを用いて「1日の推奨カロリー・栄養素目安（タンパク質、脂質、炭水化物、鉄分、葉酸など）」を自動算出する。
	• 必須項目:
		○ 年齢
		○ 性別（女性固定を想定）
		○ 妊娠週数（または出産予定日）
		○ 身長
		○ 体重
	• 入力形式:
		○ 年齢: 数値入力またはプルダウン
		○ 妊娠週数: 数値入力またはカレンダー入力
		○ 身長: 数値入力（cm）
		○ 体重: 数値入力（kg）
	• 出力:
		○ 1日の推奨カロリー・栄養素目安を算出し、ダッシュボードで可視化。
		○ 計算ロジックはDifyのLLMを活用してバックエンドで行い、結果を返す。
	• 備考:
		○ 本機能で登録された情報は、食事記録の自動計算・栄養バランスの評価・献立提案に利用。
		○ 将来的には家族構成（子どもの年齢など）入力も追加し、家族分の献立管理機能へ拡張可能。
2-2. 食事記録（ログ機能）
	• 入力方法:
		○ マルチモーダル入力 
			1. アプリ内カメラによる写真撮影
			2. 端末の写真アプリからの画像選択
			3. テキスト入力（食材・メニュー名の直接入力）
	• 必須項目:
		○ 食材/メニュー名
		○ 摂取量
		○ 時間帯（朝・昼・夜・間食など）
	• 自動機能:
		○ 画像解析（写真からの自動推定）
		○ LLMによるカロリー・栄養素計算ロジック
		○ 誤差修正可能なUI：ユーザーが補正や編集を行いやすいフォームを用意。
	• 備考:
		○ MVPの段階では、推定精度の目安を設定（例: 80%程度の精度を想定）。
		○ 実際に撮影・推定した食事記録は、ダッシュボードの摂取状況に即時反映される。
2-3. 簡易ダッシュボード（栄養バランス確認）
	• 表示内容:
		○ 1日の総摂取カロリー、主要栄養素の達成率（例: タンパク質、脂質、炭水化物、鉄分、葉酸など）
		○ 円グラフまたはバーグラフで可視化
	• アラート:
		○ 不足・過剰な項目を色分け表示で注意喚起
		○ LLMによるワンポイントアドバイス（例: 「鉄分を増やすためにレバーやほうれん草を取り入れてみましょう」など）
	• 備考:
		○ シンプルなUIを優先し、1画面で1日の状況が確認できる設計。
		○ 週単位・月単位のグラフ切替はMVP後に拡張可能。
2-4. 献立提案（レコメンド機能）
	• レシピ提案:
		○ 当日または翌日の夕食向けに、3〜5件の簡単・時短レシピを表示
		○ 妊娠中の注意食材（生肉やアルコールなど）を自動フィルタ可能
	• アルゴリズム:
		○ 食事記録からの不足栄養素やユーザー嗜好タグ（辛いもの苦手、和食好きなど）を参照
		○ DifyのLLMを活用し、最適なレシピ候補を取得
		○ 調理時間、難易度、栄養素情報なども表示
	• 備考:
		○ レシピ詳細画面には調理ステップや必要食材を明示。
		○ 利用者の手間を軽減するために、調理時間は30分以内を優先して提案。
2-5. リマインド・通知機能
	• 機能:
		○ 食事記録の入力忘れ防止プッシュ通知（朝・昼・夜など、任意の時間設定）
		○ 妊娠週数に応じた栄養アドバイス定期配信
		○ 「妊娠○週: そろそろ体重管理に注意しましょう」といったメッセージを表示
	• 備考:
		○ 通知頻度や時間をユーザーが調整可能にする。
		○ 将来的には、産後の離乳食・子どもの栄養管理を通知する機能にも拡張可能。

3. システムアーキテクチャと技術スタック
3-1. フロントエンド
	• フレームワーク: Next.js
		○ Next AI SDK（ver.4.1 予定）を利用し、LLM連携やプロンプトオーケストレーションを実装。
		○ PWA（プログレッシブウェブアプリ）として設計し、スマホでもアプリ感覚で利用可能にする。
	• UI/UX:
		○ モバイルファーストデザイン、シンプルで直感的なインターフェース。
		○ 必要な操作（食事記録、献立レコメンドなど）を1〜2タップで完結できる構成。
3-2. バックエンド
	• AI連携:
		○ DifyをAI LLMエンジンとして利用し、自然言語処理や画像解析を組み合わせた栄養推定＆レコメンド機能を実装。
		○ Difyのワークフロー機能により、食材解析ロジックやプロンプト設計を柔軟に制御。
	• API統合:
		○ フロントエンド（Next.js）からは、Difyが提供するRESTful APIをリアルタイムで呼び出し、解析結果を即時取得。
		○ ユーザーのリクエストが増加した際のスケーラビリティも念頭に置く。
3-3. データベース
	• DB選定: Supabase（PostgreSQLベース） 
		○ ユーザープロファイル、食事ログ、レシピ情報、通知設定などを安全に管理。
		○ リアルタイム更新機能を活用し、ダッシュボードに即時反映。
		○ 将来的に家族情報や子どものプロフィールを追加する際にも柔軟に拡張可能。

4. ユーザーストーリー（MVP想定）
	1. ユーザー同意画面
		○ アプリを初回起動 → 「LLM活用の回答は常に正確ではない」「医師への相談が必要」「本アプリは妊婦の簡易栄養管理ツール」など免責事項を表示 → 「同意する」ボタンを押すとメイン画面へ遷移。
	2. アカウント作成
		○ メールアドレス／パスワードの登録 → ユーザープロファイル（年齢、妊娠週数、身長、体重）を入力 → 推奨カロリー・栄養素目安を自動算出 → ダッシュボードに反映。
	3. 食事記録の入力
		○ 食事のタイミングでプッシュ通知 → カメラ撮影 or 画像選択 or テキスト入力 → LLMによるカロリー・栄養素推定 → 結果をユーザーが補正可能 → 記録完了。
	4. ダッシュボード確認とアラート表示
		○ 1日の摂取カロリー・栄養素を円グラフまたはバーグラフで表示 → 過不足があれば色分けアラート → LLMの簡易アドバイスも併載。
	5. 夕食献立の提案
		○ 「献立を提案」ボタン → Difyバックエンドのレコメンドロジック → 時短レシピ一覧（3〜5件）を表示 → 調理時間や栄養素を確認し選択。
	6. リマインド通知と継続利用促進
		○ 食事記録忘れ防止の定時プッシュ通知 → 妊娠週数に応じたアドバイスも自動送信。

5. 非機能要件
	• パフォーマンス:
		○ フロントエンド操作（入力や画面表示）は1〜2秒以内に応答。
		○ 食事画像解析・栄養計算結果のレスポンスタイムは最大5秒以内を目標とする（MVP時）。
	• セキュリティ:
		○ ユーザーの健康情報と連絡先情報をHTTPS通信で暗号化。
		○ Supabaseの認証機能およびロール・権限設定でアクセス制御。
	• 拡張性:
		○ 家族分の栄養管理や音声入力など、追加機能を視野に入れた設計。
		○ 食品データベースや外部API連携により機能を強化可能。
	• 可用性:
		○ サーバーダウン時のリカバリ設計、定期バックアップの運用。
		○ ユーザーが万が一登録に失敗した際のリトライ処理。

6. 優先度とリリース計画
機能	優先度	リリース時期	備考
ユーザープロファイル設定	High	MVPリリース初期	基本機能
食事記録（マルチ入力対応）	High	MVPリリース初期	カメラ／写真／テキスト入力の統合
簡易ダッシュボード(1日)	High	MVPリリース初期	栄養バランスの可視化
ダッシュボード（週間、月間）	medium	リリース中期	本格的な栄養バランスの可視化
献立提案（レコメンド機能）	High	MVPリリース初期～中期	AI LLM（Dify）連携による提案
リマインド通知	Medium	MVPリリース初期～中期	継続利用促進のための通知機能
家族構成管理機能	Low	今後のアップデート	MVPでは個人ユーザー向け。将来的に家族拡張を視野
	• ユーザー同意画面: High（重要な免責事項のため） 
		○ MVPリリース初期に実装。

7. 画面遷移・UI概要（補足）
7-1. ログイン／ユーザー同意画面
	1. ログイン画面 
		○ メールアドレス／パスワードの入力欄
		○ 新規登録リンク
	2. ユーザー同意画面 
		○ LLMの回答が必ずしも正確ではないこと、本アプリは医療行為ではないことを明示
		○ 「同意する」「同意しない」ボタンを設置
		○ 「同意しない」を選択時は主要機能を利用できない
7-2. プロファイル入力画面
	• 年齢、妊娠週数（または出産予定日）、身長、体重、目標体重（体重増加目安）を入力 → 保存 → ダッシュボードに反映
7-3. ダッシュボード画面
	• 「今日の摂取カロリー・栄養素」円グラフ／バーグラフ
	• 「不足・過剰」アラート表示
	• 「食事ログ入力」「献立提案」などのボタン配置
7-4. 食事記録画面
	• カメラ起動／写真選択／テキスト入力のボタン
	• 推定結果の確認と補正フォーム
	• 保存後、ダッシュボードに反映
7-5. 献立提案画面
	• 不足栄養素に基づくレシピリスト
	• 各レシピの詳細表示（調理時間、難易度、栄養価など）
7-6. 通知設定画面
	• 通知オン／オフ
	• 通知タイミング（朝・昼・夜の時間帯）
	• 妊娠週数アドバイス通知のオン／オフ

8. まとめ・今後の展開
	• 本要件定義書は、妊娠中の多忙な女性向けに「簡易な栄養管理と献立作成を支援するMVP」を構築するための指針を示します。
	• LLMの回答と画像解析を組み合わせることで、従来の手動入力に比べスムーズな記録体験を提供し、栄養不足を補いやすくする工夫を取り入れています。
	• しかしながら、あくまでも「医療的アドバイス」や「健康診断」の代替ではなく、補助的なツールであることを明確にし、ユーザーにもその旨を同意画面でしっかり理解してもらう必要があります。
	• MVP段階で収集したユーザーフィードバックを踏まえ、精度向上や家族構成管理、離乳食期への拡張などを進めることで、長期的な利用価値を高めることが可能です。
	• 産後も使えるアプリとしての発展
	• 週単位、月単位で可視化のダッシュボード設計など
