# manmaruアプリ レシピ機能 画面設計方針

## 1. 概要

manmaruアプリのレシピ機能は、妊婦向け栄養管理の一環として、ユーザーが外部レシピサイトのコンテンツをクリップし、栄養価を自動計算して保存・管理できる機能を提供します。この設計方針は、MVPリリースに向けたレシピ機能の画面設計と実装方針を定義します。

### 目的

- 妊婦が必要な栄養素を考慮したレシピの発見を容易にする
- 外部レシピサイトのコンテンツを効率的に活用できる仕組みを提供する
- 食事記録と連携し、栄養管理のサイクルを完成させる
- 法的リスクを最小限に抑えつつ良好なユーザー体験を提供する

## 2. 画面構成の全体像

```
ナビゲーション
├── ホーム
│   ├── 食事を記録するカード (直接 meals/log に遷移)
│   ├── レシピを探すカード (行動喚起)
│   └── おすすめレシピカード (一般的なレコメンド)
├── ダッシュボード
│   └── パーソナライズドレシピカード (栄養状態に基づく)
├── 食事記録 → meals/log (拡張版)
│   ├── 通常食事記録 (テキスト/画像入力)
│   ├── 食事履歴閲覧
│   └── クリップレシピからの記録機能
├── レシピ
│   ├── URLクリップ機能
│   ├── マイレシピライブラリ
│   └── レシピ検索・フィルター
└── プロフィール
```

## 3. 詳細画面設計

### 3.1 ホーム画面（レシピ関連コンポーネント）

**目的**: 日常的な入口として、レシピ機能への導線と一般的なレコメンドを提供

**コンポーネント構成**:
- **レシピを探すカード**:
  - デザイン: 大きな行動喚起ボタン
  - 機能: タップすると「レシピ検索モーダル」を表示
  - メッセージ例: 「今日は何を作る？条件から探してみよう」

- **おすすめレシピセクション**:
  - タイトル: 「今日のおすすめ」
  - コンテンツ: 時短レシピや季節のレシピなど一般的な提案
  - 表示形式: 横スクロールカード形式（2-3件表示）
  - 各カード: 料理画像、タイトル、調理時間、カテゴリタグ、「+」簡易記録ボタン
  - アクション: タップでレシピ詳細画面へ、「+」ボタンで簡易食事記録

### 3.2 ダッシュボード画面（レシピ関連コンポーネント）

**目的**: 栄養状態に基づくパーソナライズされたレシピ提案

**コンポーネント構成**:
- **パーソナライズドレシピカード**:
  - タイトル: 「あなたにおすすめ」
  - サブタイトル: 「鉄分が不足気味です。これらのレシピがおすすめ」など状態に応じたメッセージ
  - 表示形式: 横スクロールカード形式（2-3件表示）
  - 各カード: 料理画像、タイトル、不足栄養素を補える理由、カテゴリタグ、「+」簡易記録ボタン
  - アクション: タップでレシピ詳細画面へ、「+」ボタンで簡易食事記録

- **未来実装用スペース**:
  - 献立セット提案のためのプレースホルダー
  - MVP段階では非表示または「Coming Soon」表示

### 3.3 レシピページ

**目的**: レシピのクリップ、管理、検索の中心機能

**画面構成**:
- **トップセクション**: レシピクリップ機能
  - URLテキスト入力フィールド
  - クリップボタン
  - 処理中インジケーター

- **マイレシピライブラリ**:
  - タブナビゲーション:
    - すべて
    - お気に入り
    - カテゴリ別（主菜、副菜、汁物、主食）
  - 表示形式: グリッドレイアウト（2列）
  - 各カード: サムネイル、タイトル、カテゴリタグ、お気に入りアイコン、「+」簡易記録ボタン
  - フィルター機能: カテゴリ、栄養素フォーカスなど

- **検索バー**:
  - キーワード検索
  - 詳細検索ボタン（条件指定モーダルを開く）

### 3.4 レシピ詳細画面

**目的**: クリップしたレシピの詳細表示と食事記録への連携

**注意**: これはアプリのネイティブUIであり、元のレシピサイトを表示するアプリ内ブラウザとは別物です

**画面構成**:
- **ヘッダー**: 
  - レシピ画像（大きく表示）
  - タイトル
  - お気に入りボタン
  - 「調理手順を見る」ボタン（アプリ内ブラウザを起動）

- **栄養情報セクション**:
  - カロリー、タンパク質、脂質、炭水化物の基本情報
  - 妊婦に重要な栄養素（鉄分、葉酸、カルシウム）の強調表示
  - 栄養素バーグラフ（日々の必要摂取量との比較）

- **注意喚起セクション**（該当する場合）:
  - 警告アイコンとメッセージ
  - 「生食材が含まれています」「高水銀魚が含まれています」など

- **材料リスト**:
  - 材料名と分量
  - 人数調整スライダー

- **アクションボタン**:
  - 「今日食べた」ボタン（食事記録連携）
  - 分量選択ドロップダウン（全量、1/2、1/3など）
  - 食事タイプ選択（朝食、昼食、夕食、間食）

### 3.5 アプリ内ブラウザ画面

**目的**: 元のレシピサイトのコンテンツを表示し、詳細な調理手順を確認

**画面構成**:
- **ヘッダー**:
  - 「戻る」ボタン（レシピ詳細画面に戻る）
  - サイト名
  - アクションボタン（共有、ブラウザで開くなど）

- **WebViewコンテンツ**:
  - 元のレシピサイトをそのまま表示
  - リンクやビデオも正常に機能
  - スクロール、ズームなどの操作もサポート

- **フッター**（オプション）:
  - 「今日食べた」ボタン（いつでも記録できるよう）
  - 「お気に入りに追加」ボタン

### 3.6 レシピ検索モーダル

**目的**: ホームの「レシピを探す」から起動、条件指定検索

**画面構成**:
- **検索条件セクション**:
  - カテゴリ選択（主菜、副菜、汁物、主食）のタブまたはチップス
  - 栄養素フォーカス選択（鉄分、葉酸、カルシウムなど）のチップス
  - 調理時間フィルター（15分以内、30分以内など）

- **コンテキスト検索セクション**（ユーザーの状況により表示）:
  - 「主菜○○に合う副菜を探す」（直近で主菜を食べた場合）
  - 「今日の不足栄養素を補うレシピ」（栄養素が不足している場合）

- **検索結果表示**:
  - グリッドまたはリスト表示
  - 各結果: サムネイル、タイトル、マッチ理由（「鉄分豊富」など）、「+」簡易記録ボタン
  - 無限スクロール実装

### 3.7 レシピクリップフロー

**目的**: URLからレシピ情報を抽出し保存するプロセス

**画面遷移**:
1. **URLエントリー画面**:
   - URL入力フィールド
   - クリップボタン
   - クリップ履歴（直近3件）

2. **処理中画面**:
   - アニメーションローディング
   - 「レシピ情報を抽出中...」メッセージ

3. **情報確認・編集画面**:
   - 抽出されたタイトル（編集可能）
   - サムネイル画像（他の画像を選択可能）
   - カテゴリ選択（主菜、副菜、汁物、主食）
   - 自動抽出された材料リスト（編集可能）
   - 計算された栄養素情報（調整可能）
   - 注意食材ハイライト（検出された場合）

4. **保存完了画面**:
   - 成功メッセージ
   - レシピサムネイルプレビュー
   - アクションボタン:
     - 「詳細を見る」
     - 「別のレシピをクリップ」
     - 「今日食べた」（食事記録連携）

### 3.8 簡易食事記録モーダル

**目的**: レシピカードの「+」ボタンから起動し、最小限の操作で食事記録

**画面構成**:
- **レシピ情報表示**:
  - レシピ名
  - サムネイル（小）

- **記録オプション**:
  - 食事タイプ選択（朝食/昼食/夕食/間食）
  - 分量選択（プリセット: 全量/1/2/1/3）
  - 日付選択（デフォルト: 今日）

- **アクションボタン**:
  - 「記録する」ボタン
  - 「キャンセル」ボタン

### 3.9 拡張食事記録ページ

**目的**: 食事記録の一元管理と様々な記録方法の提供

**画面構成**:
- **セグメントコントロール**:
  - 「記録する」（デフォルト）
  - 「履歴を見る」
  - 「レシピから記録」

- **「記録する」タブ**:
  - 現在の実装（テキスト/画像入力）

- **「履歴を見る」タブ**:
  - 日付別食事記録一覧
  - 編集/削除機能
  - 栄養サマリー

- **「レシピから記録」タブ**:
  - 「最近閲覧したレシピ」セクション
  - 「お気に入りレシピ」セクション
  - 検索機能
  - 結果: レシピカードリスト（「+」記録ボタン付き）

## 4. 元レシピサイトへのアクセス方法

**アプリ内ブラウザ方式（推奨）**:
- レシピ詳細画面に「調理手順を見る」ボタンを配置
- タップでアプリ内ブラウザ（WebView）が起動
- 元のレシピサイトを表示（著作権リスク軽減）
- ヘッダーに戻るボタンでアプリに戻る機能
- 将来的にはYouTubeやTikTokなどの動画コンテンツも対応

## 5. 食事記録連携フロー

manmaruアプリでは、レシピから食事記録への連携に複数の経路を提供し、ユーザーの利便性を高めます：

### 5.1 レシピ詳細画面からの記録

1. **レシピ詳細画面での記録開始**:
   - 画面下部に「今日食べた」大型アクションボタンを配置
   - タップすると記録フローがスタート

2. **食事情報入力モーダル**:
   - 分量選択: スライダーまたはプリセット（全量、1/2、1/3など）
   - 食事タイミング選択: 朝食、昼食、夕食、間食のアイコン選択
   - 日付選択: デフォルトは「今日」、変更可能

3. **確認と登録**:
   - 選択内容の確認表示
   - 「記録する」ボタンタップで登録完了
   - 成功時に簡単なアニメーションでフィードバック

### 5.2 レシピカードからの簡易記録

1. **レシピカードの「+」ボタンタップ**:
   - 各レシピカードに小さな「+」ボタンを配置
   - どの画面（ホーム/ダッシュボード/レシピ一覧/検索結果）でも利用可能

2. **簡易食事記録モーダル**:
   - コンパクトなモーダルで最小限の情報入力
   - 食事タイプと分量の簡易選択
   - 「記録する」ボタンで即座に記録

### 5.3 食事記録ページからのレシピ選択

1. **食事記録ページの「レシピから記録」タブ**:
   - セグメントコントロールで「レシピから記録」を選択
   - 最近閲覧したレシピやお気に入りを表示
   - 検索機能でレシピを探せる

2. **レシピ選択と記録**:
   - 表示されたレシピから選択
   - 食事情報入力フォームが表示
   - 記録の確定

## 6. データフロー

**レシピクリップと食事記録の連携フロー**:

1. **クリップしたレシピは `clipped_recipes` テーブルに保存**
   - レシピそのものの情報（タイトル、URL、画像、栄養価など）

2. **ユーザーがレシピを「今日食べた」と記録した場合**:
   - `meals` テーブルに新しい食事レコードを作成
   - `meal_nutrients` テーブルに栄養素情報を保存
   - `meal_recipe_entries` テーブルに関連付け情報を保存

## 7. UI共通要素とデザイン指針

### 7.1 レシピカードの共通仕様
- **サイズ**: 160dp×200dp
- **構成**:
  - サムネイル(60%)
  - 情報エリア(35%)
  - アクションエリア(5%)：お気に入りアイコンと「+」記録ボタン
- **情報**: タイトル(2行まで)、カテゴリタグ、栄養フォーカスアイコン
- **タップアクション**: レシピ詳細画面に遷移
- **「+」ボタンアクション**: 簡易食事記録モーダルを表示

### 7.2 栄養素バッジ
- **デザイン**: 円形または丸角長方形
- **表示**: アイコン+栄養素名
- **色分け**: 鉄分(赤)、葉酸(緑)、カルシウム(青)など

### 7.3 警告表示
- **デザイン**: 黄色または赤の注意アイコン
- **表示位置**: 関連コンテンツの上部
- **スタイル**: 軽量で目立ちすぎない、必要時に詳細表示

### 7.4 レスポンシブ対応
- **モバイル**: 上記設計をベースに最適化
- **タブレット**: 2ペイン表示（一覧と詳細を同時表示）
- **デスクトップ**: タブレットと同様、余白を活用した配置

## 8. 実装優先順位とフェーズ計画

### フェーズ1（初期MVP）
1. **レシピページの基本機能**
   - URLクリップ機能
   - レシピライブラリ表示
   - 簡易検索・フィルター
   
2. **レシピ詳細画面**
   - 基本的な栄養情報表示
   - 簡易警告表示
   - 食事記録連携の基本機能

3. **アプリ内ブラウザ**
   - WebView実装
   - 基本的なナビゲーション制御

### フェーズ2（MVP完成）
1. **ホーム画面連携**
   - レシピを探すカード
   - 基本的なおすすめレシピ表示

2. **検索機能拡充**
   - 詳細な条件フィルタリング
   - コンテキスト検索の簡易版

3. **拡張食事記録連携**
   - レシピカードの「+」ボタン実装
   - 簡易食事記録モーダル
   - 食事記録ページの「レシピから記録」タブ

### フェーズ3（将来拡張）
1. **ダッシュボード統合**
   - 栄養状態に基づくパーソナライズドレコメンデーション
   - 1汁3菜などの献立セット提案

2. **高度なAI機能**
   - 食材画像認識
   - 好み学習
   - 季節性考慮

## 9. 画面間の関連性と遷移

### 主要な遷移パス
1. **ホーム → レシピ検索モーダル → レシピ詳細 → アプリ内ブラウザ**
   - 一般的な探索フロー
   - 最後のステップはオプション（調理手順を見る場合）

2. **ダッシュボード → パーソナライズドレシピ → レシピ詳細**
   - 栄養状態に基づく推奨フロー

3. **レシピページ → URLクリップ → 確認・編集 → 保存完了**
   - レシピ保存フロー

4. **レシピ詳細 → 食事記録連携 → 確認 → 記録完了**
   - 食事記録フロー

5. **レシピカード「+」ボタン → 簡易食事記録モーダル → 記録完了**
   - クイック記録フロー

6. **食事記録 → 「レシピから記録」タブ → レシピ選択 → 記録完了**
   - 食事記録からのレシピ検索フロー

## 10. まとめ

本設計では、manmaruアプリのレシピ関連機能を、ユーザー体験を中心に考えた画面設計で統合しました。MVP段階では基本的なURLクリップ機能と栄養計算、そして食事記録連携に焦点を当て、将来的にはより高度なパーソナライズ機能へと拡張できる基盤を整えています。

特に重要なのは、以下の点です：

1. **レシピ詳細とアプリ内ブラウザの明確な分離**
   - レシピ詳細：アプリが付加価値を提供する画面
   - アプリ内ブラウザ：元サイトの内容をそのまま表示

2. **複数の食事記録経路の提供**
   - レシピ詳細からの詳細記録
   - レシピカードからの簡易記録
   - 食事記録ページからのレシピ検索

3. **ナビゲーション構造の最適化**
   - ホーム：日常的なエントリーポイント
   - ダッシュボード：パーソナライズされた栄養対応レシピ
   - 食事記録：多様な記録方法の統合
   - レシピページ：クリップと管理の中心機能

この設計により、妊婦ユーザーは効率的に栄養価の高いレシピを発見、保存、活用できるようになり、アプリの中核価値である「妊娠期の最適な栄養管理」をさらに強化することができます。 