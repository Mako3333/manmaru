# manmaruアプリ 総合実装戦略レポート

## プロジェクト概要

**manmaru**（まんまる）は妊婦向け栄養管理アプリであり、多忙な妊婦が簡単に栄養バランスを管理し、適切な献立作成を行えるよう支援するツールです。食事記録、栄養分析、レシピ推奨を中核機能とし、妊娠期特有の栄養ニーズに対応したパーソナライズされたサポートを提供します。このアプリは妊娠期の健康管理をより簡単かつ効果的にすることで、母子の健康増進に貢献することを目指しています。


## 現状と実装状況

### 実装済み機能

1. **ユーザー認証基盤**
   - Supabase Authによるログイン/登録フロー
   - ユーザープロファイル管理（年齢、妊娠週数、身長、体重など）

2. **UI基盤コンポーネント**
   - モバイルファーストのレスポンシブデザイン
   - shadcn/uiベースのコンポーネントライブラリ
   - ボトムナビゲーションとヘッダー

3. **食事記録機能**
   - 画像アップロード/カメラ撮影インターフェース
   - テキスト入力による食品登録
   - 食事タイプ選択（朝食/昼食/夕食/間食）

4. **AI画像解析**
   - Gemini APIによる食品画像認識
   - 認識結果の編集インターフェース
   - 栄養素自動計算

5. **栄養ダッシュボード**
   - 日次栄養スコア表示
   - 不足栄養素の可視化
   - 栄養摂取履歴表示

6. **不足栄養素に基づく栄養アドバイス**
   - トライメスター別の栄養目標設定
   - 不足栄養素の検出と優先度付け
   - パーソナライズされたアドバイス生成

### MVPリリースまでの優先実装項目

1. **レシピ提案機能**
   - バランスの取れた「1汁3菜」献立提案
   - 不足栄養素を補う最適レシピ推奨
   - レシピ検索・フィルタリング機能

2. **食事認識と栄養素計算の精度向上**
   - 一般的な食品の標準量設定
   - 曖昧さのある食品入力の選択UIの改善
   - ユーザーによる簡易修正機能

3. **避けるべき食品の警告機能**
   - 妊娠中に注意が必要な食品の自動検出
   - 警告表示と代替提案
   - 生もの、高水銀魚、高ビタミンA食品などのリスク管理

4. **UI/UX最終調整**
   - 全体のユーザーフロー最適化
   - エラー処理とフィードバック強化
   - パフォーマンス最適化

## レシピ提案機能の詳細設計

### 提案方式の差別化

#### 1. ダッシュボード画面の「今日のバランス献立セット」

**概要**: ユーザーの栄養状態に基づいた完成度の高い「1汁3菜」の献立セットを提案します。不足している栄養素を効率的に補う組み合わせを最適化し、栄養バランスを優先します。

**具体的な内容**:
- 2種類の完成献立セットを横並びカードで表示
- 各献立セットは主食・主菜・副菜・汁物の構成
- 不足栄養素を補うための栄養フォーカスを明示
- 献立全体の盛り付けイメージを視覚的に表示
- 「鉄分強化セット」「葉酸補給に最適」などのラベル表示

**提案アルゴリズム**:
- 直近の食事記録からの栄養摂取パターン分析
- トライメスターに応じた重要栄養素の優先度設定
- 最も不足している栄養素を補える献立組み合わせの選出
- 食事制限・アレルギー情報に基づくフィルタリング

#### 2. レシピ検索画面の「自由に組み合わせる料理ライブラリ」

**概要**: ナビゲーションメニューからアクセスする画面では、ユーザーが主体的に料理を探索・組み合わせできる自由度の高いインターフェースを提供します。カテゴリ別の検索や、主菜選択後の相性の良い副菜提案など、より柔軟な料理選択を支援します。

**具体的な内容**:
- カテゴリタブ（主菜/副菜/汁物/主食）で料理を分類表示
- 詳細検索条件（栄養素フォーカス、料理タイプ、好みなど）
- 主菜選択後に相性の良い副菜・汁物を推奨
- 料理の詳細情報（栄養価、材料、手順）の表示
- 人数調整機能（家族構成に応じた分量自動調整）

**検索・フィルタリング機能**:
- 調理時間、難易度によるフィルタリング
- 栄養素フォーカスによる絞り込み
- トライメスター適合性によるフィルタリング
- 食事制限・アレルギー対応の除外機能

### データモデル設計

```
recipes テーブル
- id: UUID (PK)
- title: TEXT - レシピ名
- description: TEXT - 簡単な説明
- image_url: TEXT - 料理画像URL
- recipe_type: TEXT - 'main_dish', 'side_dish', 'soup', 'rice'
- serving_size: INTEGER - 基本人数
- nutrition_per_serving: JSONB - 1人分の栄養情報
  {
    "calories": 350,
    "protein": 20,
    "iron": 2.5,
    "folic_acid": 120,
    "calcium": 180,
    "vitamin_d": 2
  }
- nutrition_focus: TEXT[] - ['iron', 'folic_acid'] など強化栄養素
- category: TEXT[] - ['japanese', 'western', 'chinese'] など
- tags: TEXT[] - ['morning_sickness_friendly', 'quick', 'easy'] など
- pregnancy_stage: TEXT[] - ['first_trimester', 'second_trimester', 'third_trimester']
- ingredients: JSONB - 材料情報
  [
    {"name": "鶏むね肉", "quantity": 200, "unit": "g"},
    {"name": "玉ねぎ", "quantity": 1, "unit": "個"}
  ]
- steps: JSONB - 調理手順
  [
    {"step_number": 1, "description": "鶏肉を一口大に切ります"},
    {"step_number": 2, "description": "玉ねぎをスライスします"}
  ]
- created_at: TIMESTAMP
```

```
meal_sets テーブル
- id: UUID (PK)
- name: TEXT - 献立セット名
- description: TEXT - 献立の説明
- image_url: TEXT - 献立全体のイメージURL
- main_dish_id: UUID (FK to recipes)
- side_dish1_id: UUID (FK to recipes)
- side_dish2_id: UUID (FK to recipes, オプション)
- soup_id: UUID (FK to recipes)
- rice_id: UUID (FK to recipes)
- total_nutrition: JSONB - 献立全体の栄養価
- nutrition_focus: TEXT[] - 献立セットの栄養素フォーカス
- pregnancy_stage: TEXT[] - 適合するトライメスター
- created_at: TIMESTAMP
```

### レシピ提案アプローチ

MVPでは「ハイブリッドキュレーション方式」を採用します：

1. **基本レシピライブラリの構築**
   - 妊婦の栄養ニーズに特化した30-50の核レシピをDB登録
   - 各レシピカテゴリ（主菜、副菜、汁物、主食）ごとに10-15種類
   - すべてのレシピに栄養素フォーカス、トライメスター適合性のタグ付け

2. **献立セットのキュレーション**
   - 栄養士監修による20-30パターンの献立セットを事前登録
   - 各セットは不足しがちな栄養素（鉄分、葉酸、カルシウムなど）に対応
   - トライメスター別の最適献立を用意

3. **LLMによる拡張**
   - レシピや献立の説明文生成
   - 代替食材や調理のコツの提案
   - 食事制限に応じたアレンジ提案

このアプローチにより、少ないリソースでもMVP段階から価値の高いレシピ提案機能を実現できます。将来的には実際のユーザーデータに基づき、AIによる動的な献立生成にも発展させることができます。

## 実装計画

### フェーズ1: レシピ提案機能のMVP実装（2週間）

#### 1日目〜3日目: 基本データ構造とサンプルレシピ登録
- レシピテーブル・献立セットテーブルの設計と実装
- データベース移行スクリプトの作成
- 基本レシピデータの登録（各カテゴリ10種類程度）
- APIエンドポイントの基本実装

#### 4日目〜7日目: ダッシュボード用献立提案機能
- 不足栄養素に基づく献立組み合わせロジックの実装
- 献立セットのカードUIコンポーネント開発
- 献立詳細表示画面の実装
- 栄養素フォーカスの視覚化（アイコン・グラフ）

#### 8日目〜12日目: レシピ探索機能
- レシピ検索・フィルタリング機能の実装
- カテゴリ別表示UIの開発
- レシピ詳細画面の実装
- 人数調整機能の実装
- 主菜と副菜の組み合わせ推奨機能

#### 13日目〜14日目: 総合テストと調整
- エンドツーエンドのユーザーフロー検証
- パフォーマンス最適化
- エッジケース対応
- レスポンシブデザインの確認

### フェーズ2: MVP以降の拡張（リリース後3-6ヶ月）

1. **レシピライブラリの拡充**
   - レシピデータの継続的追加（100+レシピ）
   - 季節・食材の旬を考慮したレシピローテーション
   - ユーザーフィードバックに基づく人気レシピの強化

2. **パーソナライズ機能の高度化**
   - 過去の選択傾向を学習した推奨エンジン
   - 好みや避けたい食材の詳細設定
   - 料理の相性分析アルゴリズムの精緻化

3. **ユーザーエンゲージメント向上**
   - 「お気に入りレシピ」保存機能
   - 「作ってみました」機能
   - レシピ評価・フィードバック機能

4. **購入支援機能**
   - 買い物リスト自動生成
   - 食材の使い回し最適化提案
   - 栄養素最大化・コスト最小化の献立提案

### フェーズ3: 中長期的拡張（6-12ヶ月）

1. **妊娠合併症対応機能**
   - 妊娠糖尿病向け低糖質レシピセット
   - 妊娠高血圧症候群向け減塩レシピセット
   - 医療情報と連携した栄養管理

2. **産後・授乳期モード**
   - 授乳中の栄養ニーズに対応したレシピ
   - 産後の体重管理サポートプラン
   - 時短・片手調理可能な料理の強化

3. **家族向け拡張**
   - 子ども（離乳食、幼児食）対応レシピ
   - 家族全員の好みを考慮した献立提案
   - 家族の食事管理統合ダッシュボード

4. **栄養相談チャットボット**
   - 食事・栄養に関する質問応答
   - レシピのアレンジ相談
   - 医療相談が必要なケースの判別と案内

## 避けるべき食品の警告機能詳細

### 検出カテゴリ

1. **生もの・非加熱食品**
   - 生肉、加熱不十分な肉製品（ローストビーフ、生ハムなど）
   - 生魚介（刺身、寿司、生牡蠣など）
   - ナチュラルチーズ（非加熱製造のチーズ）
   - 生卵料理（卵かけご飯など）

2. **高水銀魚**
   - キンメダイ、クロマグロ、メカジキ、ヨシキリザメなど
   - 週に1回（80g程度）までの摂取制限が推奨される魚種

3. **高ビタミンA食品**
   - レバー類（鶏レバー、豚レバーなど）
   - ウナギ
   - 妊娠初期に過剰摂取すると奇形リスクが高まる食品

4. **過剰ヨウ素含有食品**
   - 昆布の佃煮
   - 大量の昆布だし
   - 胎児の甲状腺機能に影響する可能性のある食品

5. **高カフェイン飲料**
   - コーヒー（1日2杯以上）
   - 濃い紅茶・緑茶
   - エナジードリンク、栄養ドリンク

### 実装アプローチ

1. **食品データベースの構築**
   ```
   restricted_foods テーブル
   - id: UUID (PK)
   - food_name: TEXT - 食品名
   - category: TEXT - 'raw', 'high_mercury', 'high_vitamin_a', 'high_iodine', 'high_caffeine'
   - restriction_level: TEXT - 'avoid', 'limit', 'caution'
   - max_frequency: TEXT - '週1回まで', '1日2杯まで'など
   - alternative_foods: TEXT[] - 代替食品提案
   - reason: TEXT - 制限理由の説明
   - created_at: TIMESTAMP
   ```

2. **警告検出ロジック**
   - 食事記録入力時に食品名とキーワードマッチング
   - 曖昧さを考慮した検索（部分一致、類似語など）
   - 頻度管理（例：高水銀魚の週間摂取回数カウント）

3. **警告表示UI**
   - 優先度に応じた警告レベル表示（赤：避ける、黄：制限、緑：注意）
   - 簡潔な理由説明と代替提案
   - 詳細情報へのリンク

4. **代替提案機能**
   - 栄養素プロファイルが近い安全な代替食品の提案
   - 調理法の変更提案（例：生食→加熱調理）
   - 制限レベルに応じた適切な摂取頻度の提案

## MVPの成功指標

### 1. ユーザーエンゲージメント指標

- **DAU/MAU比率**: 0.3以上を目標
- **継続率**: 30日後の継続率60%以上
- **食事記録頻度**: ユーザーあたり週5回以上
- **セッション時間**: 平均5分/日以内（効率的な使用）
- **レシピ閲覧率**: ユーザーの70%が週1回以上レシピ閲覧

### 2. 機能効果指標

- **栄養バランス改善率**: 使用開始から1ヶ月後の栄養スコア向上度
- **レシピ提案クリック率**: 表示されたレシピの20%以上がクリックされる
- **警告機能有効性**: 警告表示後の回避行動発生率
- **ユーザー満足度**: アプリ内アンケートでの評価（5段階中4.0以上）

### 3. 技術パフォーマンス指標

- **食品認識精度**: 80%以上の正確さ
- **API応答時間**: 95%のリクエストが2秒以内に応答
- **クラッシュ率**: 1%未満
- **レシピ提案の関連性**: ユーザー評価による関連度スコア（5段階中4.0以上）

## 差別化ポイントと価値提案

### 1. 妊娠期特化の栄養管理

- トライメスター別の栄養目標設定
- 妊婦特有の重要栄養素（鉄分、葉酸、カルシウム、ビタミンDなど）の重点管理
- 妊娠週数に応じた体重増加の適正管理
- 禁忌食品の自動検出と警告機能

### 2. 1汁3菜の栄養バランス献立提案

- 不足栄養素に焦点を当てたパーソナライズ献立
- 日本の食文化に根差した栄養バランス
- 主菜・副菜・汁物の組み合わせで効率的な栄養摂取
- 実用的で調理しやすいレシピ選定

### 3. 使いやすさの徹底追求

- 1〜2分で完了する食事記録プロセス
- 写真撮影による簡易入力
- 視覚的にわかりやすい栄養フィードバック
- モバイルファーストのシンプルなUI

### 4. エビデンスベースの情報提供

- 日本産科婦人科学会ガイドラインに準拠
- 厚生労働省の食事摂取基準に基づく栄養目標
- 科学的根拠に基づく食品安全情報
- 妊婦の実際のニーズを反映した機能設計

## 今後のロードマップと将来展望

### 短期（リリース後3ヶ月）

1. **基本機能の安定化と改善**
   - ユーザーフィードバックに基づくUI/UX改善
   - 食品認識精度の向上
   - レシピデータの拡充

2. **マーケティングと普及**
   - 産婦人科クリニックとの連携
   - ユーザーコミュニティの構築
   - 口コミ促進キャンペーン

### 中期（3-12ヶ月）

1. **機能拡張**
   - 産後・授乳期モードの追加
   - 妊娠合併症対応機能
   - 栄養相談チャットボット
   - 複数日献立プランナー

2. **データ活用の高度化**
   - 機械学習によるパーソナライズ強化
   - 集合データに基づく栄養傾向分析
   - 予測モデルの構築

### 長期（1年以上）

1. **エコシステム拡張**
   - 家族全体の栄養管理への拡張
   - 子育て期の食事管理継続サポート
   - 健康データ連携（母子手帳アプリ、健診データなど）

2. **ビジネスモデル発展**
   - プレミアム機能の導入
   - 専門家（栄養士、助産師）オンライン相談
   - パートナーシップ（食品メーカー、産婦人科など）

## 結論

manmaruアプリは、食事記録の簡易化と栄養分析の可視化を出発点としつつ、その真の価値は「不足栄養素に基づく1汁3菜の献立提案」という具体的なアクションにつなげる点にあります。妊婦特有の栄養ニーズと食事制限を考慮したパーソナライズされたレシピ提案は、他の妊婦向けアプリや一般的な栄養管理アプリとの明確な差別化ポイントとなります。

MVPリリースでは、すでに実装済みの栄養アドバイス機能を基盤として、「レシピ提案機能」と「避けるべき食品の警告機能」を優先的に実装することで、ユーザーに具体的な行動指針を提供し、継続的な利用を促進します。食事記録から栄養分析、そして実用的な献立提案までの一連のフローを完成させることで、妊婦の日々の食生活における具体的な悩みを解決し、manmaruアプリは妊娠期の健康的な食生活を支える信頼できるパートナーとなるでしょう。